{
  # Global options
  email admin@olympose.43-204-228-125.sslip.io
}

olympose.43-204-228-125.sslip.io {
  # Automatic HTTPS via Let's Encrypt
  
  # Compression
  encode gzip zstd
  
  # NextAuth routes MUST go to frontend (Next.js handles these)
  handle /api/auth/* {
    reverse_proxy web:3000 {
      header_up Host {host}
      header_up X-Real-IP {remote_host}
      header_up X-Forwarded-For {remote_host}
      header_up X-Forwarded-Proto {scheme}
    }
  }
  
  # Health check routes to appropriate services
  handle /api/health {
    reverse_proxy web:3000 {
      header_up Host {host}
      header_up X-Real-IP {remote_host}
      header_up X-Forwarded-For {remote_host}
      header_up X-Forwarded-Proto {scheme}
    }
  }
  
  # All other API routes to AI backend (FastAPI)
  handle_path /api/* {
    reverse_proxy ai:8001 {
      header_up Host {host}
      header_up X-Real-IP {remote_host}
      header_up X-Forwarded-For {remote_host}
      header_up X-Forwarded-Proto {scheme}
    }
  }
  
  # All other routes to frontend
  handle {
    reverse_proxy web:3000 {
      header_up Host {host}
      header_up X-Real-IP {remote_host}
      header_up X-Forwarded-For {remote_host}
      header_up X-Forwarded-Proto {scheme}
      
      transport http {
        dial_timeout 10s
        response_header_timeout 30s
      }
    }
  }
  
  # Logging
  log {
    output stdout
    level info
  }
}
